// This test should not fail with OOM during optimization.

class AA(val name:String)

inline fun <T> Iterable<T>.join(separator : CharSequence = ", ", transform : (T) -> CharSequence) : String =
        joinItems(iterator(), StringBuilder(), separator, transform).toString()

inline fun <T, A : Appendable> joinItems(ar:Iterator<T>, buffer : A, separator : CharSequence = ", ", transform : (T) -> CharSequence) : A {
    buffer.append()
    var count = 0
    for (element in ar) {
        if (++count > 1) buffer.append(separator)
        buffer.append(transform(element))
    }
    return buffer
}

fun main(args : Array<String>) {
    val ar = arrayListOf( AA("1"), AA("2") )

    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
    ar.join { it.name }
}